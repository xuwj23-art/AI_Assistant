# 🔧 配置说明 - 环境变量与 API Key

## 📖 快速理解

### 为什么需要配置环境变量？

**简单类比：**
- 环境变量 = 你的"个人设置"
- API Key = 你的"会员卡号"

就像你去健身房，需要刷会员卡才能使用器材。API Key 就是你访问 LLM 服务的"会员卡"。

### 什么时候需要配置？

| 阶段 | 是否需要 | 原因 |
|------|---------|------|
| **Phase 1** | ❌ 不需要 | 只从 arXiv 抓取数据（免费、无需密钥） |
| **Phase 2** | ❌ 不需要 | 只做本地的主题聚类（不调用外部 API） |
| **Phase 3** | ✅ 需要 | 调用 LLM 生成摘要 |
| **Phase 4** | ✅ 需要 | UI 中的摘要功能 |
| **Phase 5** | ✅ 需要 | RAG 对话功能 |

**结论：** 你可以先完成 Phase 1-2，等到 Phase 3 再配置！

---

## 🛠️ 配置步骤（3 分钟）

### Step 1: 创建 `.env` 文件

**方法 A：使用脚本（推荐）**

双击运行项目根目录下的 `create_env.bat`

**方法 B：手动创建**

```bash
# 在项目根目录
copy env.example .env
```

### Step 2: 填入你的 API Key

用任何文本编辑器（VS Code、记事本）打开 `.env` 文件。

#### 如果你使用 OpenRouter（推荐）

```env
OPENAI_API_KEY=sk-or-v1-你的OpenRouter密钥
OPENAI_API_BASE=https://openrouter.ai/api/v1
OPENAI_MODEL=openai/gpt-3.5-turbo
```

**你的情况：**
- ✅ 你在 OpenRouter 充值了 $20
- ✅ 完全够用（预计只需 $3-5）
- ✅ 国内可用，无需翻墙

#### 如果你使用 OpenAI 官方

```env
OPENAI_API_KEY=sk-你的OpenAI密钥
OPENAI_API_BASE=
OPENAI_MODEL=gpt-3.5-turbo
```

### Step 3: 验证配置

```bash
conda activate literature_review
python src/scripts/check_config.py
```

---

## 🔍 文件说明

### `env.example` - 配置模板

**作用：** 告诉你需要配置哪些变量

**内容示例：**
```env
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-3.5-turbo
```

**特点：**
- ✅ 可以提交到 Git（不含真实密钥）
- ✅ 供其他人参考

### `.env` - 真实配置

**作用：** 存储你的真实 API Key

**内容示例：**
```env
OPENAI_API_KEY=sk-or-v1-abc123...
OPENAI_MODEL=openai/gpt-3.5-turbo
```

**特点：**
- ❌ 不会提交到 Git（已在 `.gitignore` 中）
- ✅ 只存在于你的本地电脑
- ✅ 保护你的密钥安全

---

## 🔐 安全性说明

### 为什么不直接写在代码里？

**错误做法：**
```python
# ❌ 不要这样做！
api_key = "sk-or-v1-abc123..."
```

**问题：**
1. 如果你把代码提交到 GitHub，全世界都能看到你的密钥
2. 别人可以用你的密钥消费你的额度
3. 无法在不同环境使用不同配置

**正确做法：**
```python
# ✅ 从环境变量读取
from core.config import settings
api_key = settings.openai_api_key
```

**优点：**
1. 密钥不会泄露
2. 可以轻松切换不同的密钥
3. 符合工业界标准

---

## 💰 费用说明（OpenRouter）

### 你的情况
- 充值：$20
- 预计使用：$3-5
- 剩余：$15-17（可以做很多实验！）

### 详细费用估算

使用 `openai/gpt-3.5-turbo`：

| 功能 | 调用次数 | 预计费用 |
|------|---------|---------|
| Phase 3: 生成摘要 | 约 50 次 | $1-2 |
| Phase 4: UI 测试 | 约 20 次 | $0.5-1 |
| Phase 5: RAG 对话 | 约 50 次 | $1-2 |
| **总计** | - | **$3-5** |

**省钱技巧：**
1. 开发时用 `gpt-3.5-turbo`（便宜）
2. 最终演示时可以换 `gpt-4`（质量更好）
3. 使用缓存减少重复调用

---

## 🚀 OpenRouter 详细配置

### 获取 API Key

1. 访问 [OpenRouter](https://openrouter.ai/)
2. 登录你的账号
3. 进入 [Keys 页面](https://openrouter.ai/keys)
4. 创建新密钥（格式：`sk-or-v1-xxxxx`）

### 推荐模型

| 模型 | 价格 | 质量 | 推荐场景 |
|------|------|------|----------|
| `openai/gpt-3.5-turbo` | 💰 便宜 | ⭐⭐⭐ | 日常开发、测试 |
| `openai/gpt-4` | 💰💰 较贵 | ⭐⭐⭐⭐⭐ | 最终演示 |
| `anthropic/claude-3-haiku` | 💰 便宜 | ⭐⭐⭐⭐ | 高质量回答 |
| `google/gemini-pro` | 💰 免费/便宜 | ⭐⭐⭐ | 省钱选择 |

**查看完整列表：** https://openrouter.ai/models

### 完整配置示例

```env
# OpenRouter 配置（推荐）
OPENAI_API_KEY=sk-or-v1-你的密钥
OPENAI_API_BASE=https://openrouter.ai/api/v1
OPENAI_MODEL=openai/gpt-3.5-turbo

# 应用配置
APP_ENV=development
LOG_LEVEL=INFO

# 数据库配置
CHROMA_PERSIST_DIR=./data/chroma

# BERTopic 配置
EMBEDDING_MODEL=all-MiniLM-L6-v2
MIN_TOPIC_SIZE=5
```

---

## ✅ 检查清单

配置完成后，检查：

- [ ] `.env` 文件已创建
- [ ] `OPENAI_API_KEY` 已填入（以 `sk-or-v1-` 开头）
- [ ] `OPENAI_API_BASE` 已设置为 `https://openrouter.ai/api/v1`
- [ ] `OPENAI_MODEL` 已设置（如 `openai/gpt-3.5-turbo`）
- [ ] 运行 `python src/scripts/check_config.py` 检查配置

---

## 🐛 常见问题

### Q1: 我现在就需要配置吗？

**答：不需要！**
- Phase 1-2 完全不需要 API Key
- 等到 Phase 3 再配置也来得及

### Q2: OpenRouter 和 OpenAI 有什么区别？

| 维度 | OpenAI 官方 | OpenRouter |
|------|------------|-----------|
| 价格 | 标准 | 更便宜 |
| 访问 | 需要翻墙 + 国际信用卡 | 国内可用 |
| 模型 | 仅 OpenAI | 多家可选 |
| API 格式 | OpenAI 标准 | 兼容 OpenAI |

### Q3: 如何确认配置成功？

运行检查脚本：
```bash
python src/scripts/check_config.py
```

或者在 Phase 3 启动 FastAPI 时，会自动检查配置。

### Q4: 密钥会泄露吗？

**不会！**
- `.env` 文件已在 `.gitignore` 中
- 不会被提交到 Git
- 只存在于你的本地电脑

### Q5: 可以不用 LLM 吗？

**可以！**
- Phase 1-2 完全不需要 LLM
- Phase 3-5 如果不配置 API Key，相关功能会提示错误，但不影响其他功能

---

## 📚 相关文档

- **详细配置指南：** `docs/OPENROUTER_SETUP.md`
- **快速启动：** `QUICKSTART.md`
- **项目总览：** `README.md`

---

## 🎯 下一步

配置完成后：

1. **Phase 1-2：** 可以直接开始，无需 API Key
2. **Phase 3+：** 配置 `.env` 文件后即可使用所有功能

**立即开始：** 打开 `QUICKSTART.md`，按步骤运行 Phase 1！

---

**有问题随时问我！** 🚀

